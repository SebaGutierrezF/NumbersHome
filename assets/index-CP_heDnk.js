import{initializeApp as p}from"https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";import{getFirestore as h,addDoc as g,collection as m,query as y,where as b,orderBy as E,limit as v,getDocs as I}from"https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))a(o);new MutationObserver(o=>{for(const t of o)if(t.type==="childList")for(const i of t.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&a(i)}).observe(document,{childList:!0,subtree:!0});function n(o){const t={};return o.integrity&&(t.integrity=o.integrity),o.referrerPolicy&&(t.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?t.credentials="include":o.crossOrigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function a(o){if(o.ep)return;o.ep=!0;const t=n(o);fetch(o.href,t)}})();const w={apiKey:"AIzaSyDFDboBtIOwhX6QYker19RlTPhDmEAakMY",authDomain:"numberhome-5ad7c.firebaseapp.com",databaseURL:void 0,projectId:"numberhome-5ad7c",storageBucket:"numberhome-5ad7c.firebasestorage.app",messagingSenderId:"155611891211",appId:"1:155611891211:web:7bad7e2de46af2abb4290e",measurementId:"G-MXXVWCLLBD"},S=p(w),d=h(S);async function R(r){try{return(await g(m(d,"numbers"),{...r,timestamp:new Date})).id}catch(e){throw console.error("Error saving to Firebase: ",e),e}}async function N(r){try{const e=m(d,"numbers"),n=y(e,b("phoneNumber","==",r),E("timestamp","desc"),v(1)),a=await I(n);return a.empty?null:a.docs[0].data()}catch(e){throw console.error("Error querying Firebase: ",e),e}}const F={es:{title:"Consulta el origen del número telefónico",inputPlaceholder:"Ingresa el número telefónico con código de país (ej: +34612345678)",searchButton:"Consultar",loading:"Consultando...",invalidFormat:"Formato de número inválido. Use el formato +[código país][número]",numberInfo:"Información del número",country:"País",countryCode:"Código de país",location:"Ubicación",localFormat:"Formato local",carrier:"Operador",notAvailable:"No disponible",error:"Error al consultar el número. Por favor, intenta más tarde.",processingError:"Error al procesar la solicitud. Por favor, intenta más tarde.",invalidNumber:"Número no válido"},en:{title:"Check phone number origin",inputPlaceholder:"Enter phone number with country code (e.g: +34612345678)",searchButton:"Search",loading:"Searching...",invalidFormat:"Invalid number format. Use format: +[country code][number]",numberInfo:"Number Information",country:"Country",countryCode:"Country Code",location:"Location",localFormat:"Local Format",carrier:"Carrier",notAvailable:"Not available",error:"Error querying the number. Please try again later.",processingError:"Error processing request. Please try again later.",invalidNumber:"Invalid number"}},D="https://numbers-home-api.onrender.com",L=async r=>{const e=await fetch(`${D}/validate/${r}`);if(!e.ok)throw new Error(`API_ERROR_${e.status}`);return e.json()},O=(r,e)=>{const n=new Date().toISOString();return{telefono:e.trim(),country_name:(r.country_name||"").trim(),country_code:(r.country_code||"").trim(),location:(r.location||"No disponible").trim(),local_format:(r.local_format||"").trim(),carrier:(r.carrier||"No disponible").trim(),timestamp:n,created_at:n,valid:!0}},P=r=>{const e=/^\+[0-9]{1,3}[0-9]{4,14}$/;return{valido:e.test(r),mensaje:e.test(r)?"":"El formato del número no es válido. Use: +[código país][número]"}},_=r=>{const e=JSON.parse(localStorage.getItem("historial")||"[]");e.includes(r)||(e.unshift(r),e.length>5&&e.pop(),localStorage.setItem("historial",JSON.stringify(e)))},A=()=>{const r=JSON.parse(localStorage.getItem("historial")||"[]");return r.length>0?`
            <div class="historial">
                <h3><i class="fas fa-history"></i> Búsquedas recientes</h3>
                <ul>
                    ${r.map(e=>`
                        <li>
                            <span>${e}</span>
                            <button onclick="consultarNumero('${e}')">
                                <i class="fas fa-search"></i>
                            </button>
                        </li>
                    `).join("")}
                </ul>
            </div>
        `:""};let C=localStorage.getItem("lang")||"es";document.getElementById("telefonoForm").addEventListener("submit",async function(r){r.preventDefault();const e=document.getElementById("telefono").value.trim(),n=document.getElementById("resultado"),a=document.querySelector(".map-container"),o=F[C];try{const{valido:t,mensaje:i}=P(e);if(!t)throw new Error("INVALID_FORMAT");n.style.display="block",n.innerHTML=o.loading,a.style.display="none";const{success:f,data:c}=await N("numbers","telefono",e);if(!f)throw new Error("FIREBASE_QUERY_ERROR");let s;if(!c.empty)s=c.docs[0].data();else{const l=await L(e);if(l.valid){const u=O(l,e);if(!(await R("numbers",u)).success)throw new Error("FIREBASE_SAVE_ERROR");s=u}else throw new Error("INVALID_PHONE")}s&&(_(e),document.querySelector(".historial-container").innerHTML=A(),actualizarInterfazConDatos(s,n,o),mostrarNotificacion(o.searchSuccess,"success"))}catch(t){handleError(t,n,o)}});
